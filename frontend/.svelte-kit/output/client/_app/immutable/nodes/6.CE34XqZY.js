import{f as h,a as f,c as xe}from"../chunks/CPI-Sj6W.js";import{p as Le,z as c,A as J,u as Ce,s as n,g as t,B as re,C as e,E as s,a as Re,D as Ne,$ as Oe,F as a,G as M,H as oe,K as qe}from"../chunks/DZJbeXPm.js";import{s as b}from"../chunks/DRMUDMiI.js";import{i as V}from"../chunks/LXw8YH9d.js";import{e as $t,i as Ht,s as Fe}from"../chunks/DksMkqyi.js";import{h as ke,r as C,b as S}from"../chunks/D8iSYxBw.js";import{d as Ue,e as Ve}from"../chunks/D1vpSegM.js";import{b as W,p as $e}from"../chunks/BK0TuHnG.js";import{s as He,a as Ye}from"../chunks/CWTv1oOY.js";import{a as ut,D as X}from"../chunks/DOQewpRz.js";var je=h('<div class="alert alert-error"> </div>'),ze=h("<p>Loading invoices...</p>"),Be=h('<div class="empty-state card svelte-dmf30d"><p>No invoices found. Create your first invoice to get started.</p></div>'),Ge=h('<button class="btn btn-small svelte-dmf30d">Send</button>'),Ke=h('<tr><td class="number svelte-dmf30d"> </td><td> </td><td> </td><td> </td><td> </td><td class="amount svelte-dmf30d"> </td><td><span> </span></td><td><!></td></tr>'),Qe=h('<div class="card"><table class="table"><thead><tr><th>Number</th><th>Type</th><th>Contact</th><th>Issue Date</th><th>Due Date</th><th>Total</th><th>Status</th><th>Actions</th></tr></thead><tbody></tbody></table></div>'),Je=h("<option> </option>"),Me=h('<button type="button" class="btn btn-small btn-danger svelte-dmf30d">&times;</button>'),We=h('<tr><td class="svelte-dmf30d"><input class="input" type="text" required placeholder="Product or service"/></td><td class="svelte-dmf30d"><input class="input input-small svelte-dmf30d" type="number" step="0.01" min="0.01" required/></td><td class="svelte-dmf30d"><input class="input input-small svelte-dmf30d" type="number" step="0.01" min="0" required/></td><td class="svelte-dmf30d"><select class="input input-small svelte-dmf30d"><option>22%</option><option>9%</option><option>0%</option></select></td><td class="svelte-dmf30d"><input class="input input-small svelte-dmf30d" type="number" step="0.1" min="0" max="100"/></td><td class="amount svelte-dmf30d"> </td><td class="svelte-dmf30d"><!></td></tr>'),Xe=h('<div class="modal-backdrop svelte-dmf30d" role="presentation"><div class="modal modal-large card svelte-dmf30d" role="dialog" aria-modal="true" aria-labelledby="create-invoice-title" tabindex="-1"><h2 id="create-invoice-title" class="svelte-dmf30d">Create Invoice</h2> <form><div class="form-row svelte-dmf30d"><div class="form-group svelte-dmf30d"><label class="label" for="type">Invoice Type</label> <select class="input" id="type"><option>Sales Invoice</option><option>Purchase Invoice</option><option>Credit Note</option></select></div> <div class="form-group svelte-dmf30d"><label class="label" for="contact">Contact *</label> <select class="input" id="contact" required><option>Select contact...</option><!></select></div></div> <div class="form-row svelte-dmf30d"><div class="form-group svelte-dmf30d"><label class="label" for="issue-date">Issue Date</label> <input class="input" type="date" id="issue-date" required/></div> <div class="form-group svelte-dmf30d"><label class="label" for="due-date">Due Date</label> <input class="input" type="date" id="due-date" required/></div> <div class="form-group svelte-dmf30d"><label class="label" for="reference">Reference</label> <input class="input" type="text" id="reference" placeholder="PO-12345"/></div></div> <div class="lines-section svelte-dmf30d"><h3 class="svelte-dmf30d">Invoice Lines</h3> <table class="lines-table svelte-dmf30d"><thead><tr><th class="svelte-dmf30d">Description</th><th class="svelte-dmf30d">Qty</th><th class="svelte-dmf30d">Unit Price</th><th class="svelte-dmf30d">VAT %</th><th class="svelte-dmf30d">Discount %</th><th class="svelte-dmf30d">Total</th><th class="svelte-dmf30d"></th></tr></thead><tbody></tbody><tfoot><tr><td colspan="5" style="text-align: right;" class="svelte-dmf30d"><strong>Total:</strong></td><td class="amount svelte-dmf30d"><strong> </strong></td><td class="svelte-dmf30d"></td></tr></tfoot></table> <button type="button" class="btn btn-secondary">+ Add Line</button></div> <div class="form-group"><label class="label" for="notes">Notes</label> <textarea class="input" id="notes" rows="2" placeholder="Additional notes..."></textarea></div> <div class="modal-actions svelte-dmf30d"><button type="button" class="btn btn-secondary">Cancel</button> <button type="submit" class="btn btn-primary">Create Invoice</button></div></form></div></div>'),Ze=h('<div class="container"><div class="header svelte-dmf30d"><h1 class="svelte-dmf30d">Invoices</h1> <button class="btn btn-primary">+ New Invoice</button></div> <div class="filters card svelte-dmf30d"><div class="filter-row svelte-dmf30d"><select class="input"><option>All Types</option><option>Sales Invoices</option><option>Purchase Invoices</option><option>Credit Notes</option></select> <select class="input"><option>All Statuses</option><option>Draft</option><option>Sent</option><option>Partially Paid</option><option>Paid</option><option>Overdue</option></select></div></div> <!> <!></div> <!>',1);function va(ne,ie){Le(ie,!0);const Z=()=>He($e,"$page",de),[de,le]=Ye();let $=c(J([])),Yt=c(J([])),_t=c(!0),R=c(""),H=c(!1),pt=c(""),ft=c(""),tt=c("SALES"),et=c(""),at=c(J(new Date().toISOString().split("T")[0])),st=c(J(new Date(Date.now()+336*60*60*1e3).toISOString().split("T")[0])),rt=c(""),ot=c(""),y=c(J([{description:"",quantity:"1",unit_price:"0",vat_rate:"22",discount_percent:"0"}]));Ce(()=>{const r=Z().url.searchParams.get("tenant");r&&mt(r)});async function mt(r){n(_t,!0),n(R,"");try{const[o,i]=await Promise.all([ut.listInvoices(r,{type:t(pt)||void 0,status:t(ft)||void 0}),ut.listContacts(r,{active_only:!0})]);n($,o,!0),n(Yt,i,!0)}catch(o){n(R,o instanceof Error?o.message:"Failed to load data",!0)}finally{n(_t,!1)}}function ve(){n(y,[...t(y),{description:"",quantity:"1",unit_price:"0",vat_rate:"22",discount_percent:"0"}],!0)}function ce(r){t(y).length>1&&n(y,t(y).filter((o,i)=>i!==r),!0)}function jt(r){const o=new X(r.quantity||0),i=new X(r.unit_price||0),u=new X(r.discount_percent||0),A=new X(r.vat_rate||0),_=o.mul(i),m=_.mul(u).div(100),g=_.minus(m),I=g.mul(A).div(100);return g.plus(I)}function ue(){return t(y).reduce((r,o)=>r.plus(jt(o)),new X(0))}async function _e(r){r.preventDefault();const o=Z().url.searchParams.get("tenant");if(o)try{const i=await ut.createInvoice(o,{invoice_type:t(tt),contact_id:t(et),issue_date:t(at),due_date:t(st),reference:t(rt)||void 0,notes:t(ot)||void 0,lines:t(y).map(u=>({description:u.description,quantity:u.quantity,unit_price:u.unit_price,vat_rate:u.vat_rate,discount_percent:u.discount_percent||"0"}))});n($,[i,...t($)],!0),n(H,!1),pe()}catch(i){n(R,i instanceof Error?i.message:"Failed to create invoice",!0)}}function pe(){n(tt,"SALES"),n(et,""),n(at,new Date().toISOString().split("T")[0],!0),n(st,new Date(Date.now()+336*60*60*1e3).toISOString().split("T")[0],!0),n(rt,""),n(ot,""),n(y,[{description:"",quantity:"1",unit_price:"0",vat_rate:"22",discount_percent:"0"}],!0)}async function zt(){const r=Z().url.searchParams.get("tenant");r&&mt(r)}async function fe(r){const o=Z().url.searchParams.get("tenant");if(o)try{await ut.sendInvoice(o,r),mt(o)}catch(i){n(R,i instanceof Error?i.message:"Failed to send invoice",!0)}}const me={SALES:"Sales Invoice",PURCHASE:"Purchase Invoice",CREDIT_NOTE:"Credit Note"},be={DRAFT:"Draft",SENT:"Sent",PARTIALLY_PAID:"Partial",PAID:"Paid",OVERDUE:"Overdue",VOIDED:"Voided"},he={DRAFT:"badge-draft",SENT:"badge-sent",PARTIALLY_PAID:"badge-partial",PAID:"badge-paid",OVERDUE:"badge-overdue",VOIDED:"badge-voided"};function bt(r){const o=typeof r=="object"&&"toFixed"in r?r.toNumber():Number(r);return new Intl.NumberFormat("et-EE",{style:"currency",currency:"EUR"}).format(o)}function Bt(r){return new Date(r).toLocaleDateString("et-EE")}var Gt=Ze();ke("dmf30d",r=>{Ne(()=>{Oe.title="Invoices - Open Accounting"})});var ht=re(Gt),yt=s(ht),ye=e(s(yt),2);ye.__click=()=>n(H,!0),a(yt);var gt=e(yt,2),Kt=s(gt),Y=s(Kt);Y.__change=zt;var Dt=s(Y);Dt.value=Dt.__value="";var It=e(Dt);It.value=It.__value="SALES";var St=e(It);St.value=St.__value="PURCHASE";var Qt=e(St);Qt.value=Qt.__value="CREDIT_NOTE",a(Y);var nt=e(Y,2);nt.__change=zt;var At=s(nt);At.value=At.__value="";var Et=e(At);Et.value=Et.__value="DRAFT";var Tt=e(Et);Tt.value=Tt.__value="SENT";var wt=e(Tt);wt.value=wt.__value="PARTIALLY_PAID";var Pt=e(wt);Pt.value=Pt.__value="PAID";var Jt=e(Pt);Jt.value=Jt.__value="OVERDUE",a(nt),a(Kt),a(gt);var Mt=e(gt,2);{var ge=r=>{var o=je(),i=s(o,!0);a(o),M(()=>b(i,t(R))),f(r,o)};V(Mt,r=>{t(R)&&r(ge)})}var De=e(Mt,2);{var Ie=r=>{var o=ze();f(r,o)},Se=r=>{var o=xe(),i=re(o);{var u=_=>{var m=Be();f(_,m)},A=_=>{var m=Qe(),g=s(m),I=e(s(g));$t(I,21,()=>t($),Ht,(it,p)=>{var E=Ke(),T=s(E),xt=s(T,!0);a(T);var w=e(T),j=s(w,!0);a(w);var N=e(w),z=s(N,!0);a(N);var O=e(N),dt=s(O,!0);a(O);var q=e(O),B=s(q,!0);a(q);var P=e(q),G=s(P,!0);a(P);var F=e(P),k=s(F),lt=s(k,!0);a(k),a(F);var K=e(F),Lt=s(K);{var Ct=D=>{var x=Ge();x.__click=()=>fe(t(p).id),f(D,x)};V(Lt,D=>{t(p).status==="DRAFT"&&D(Ct)})}a(K),a(E),M((D,x,vt)=>{var ct;b(xt,t(p).invoice_number),b(j,me[t(p).invoice_type]),b(z,((ct=t(p).contact)==null?void 0:ct.name)||"-"),b(dt,D),b(B,x),b(G,vt),Fe(k,1,`badge ${he[t(p).status]??""}`,"svelte-dmf30d"),b(lt,be[t(p).status])},[()=>Bt(t(p).issue_date),()=>Bt(t(p).due_date),()=>bt(t(p).total)]),f(it,E)}),a(I),a(g),a(m),f(_,m)};V(i,_=>{t($).length===0?_(u):_(A,!1)},!0)}f(r,o)};V(De,r=>{t(_t)?r(Ie):r(Se,!1)})}a(ht);var Ae=e(ht,2);{var Ee=r=>{var o=Xe();o.__click=()=>n(H,!1);var i=s(o);i.__click=d=>d.stopPropagation();var u=e(s(i),2),A=s(u),_=s(A),m=e(s(_),2),g=s(m);g.value=g.__value="SALES";var I=e(g);I.value=I.__value="PURCHASE";var it=e(I);it.value=it.__value="CREDIT_NOTE",a(m),a(_);var p=e(_,2),E=e(s(p),2),T=s(E);T.value=T.__value="";var xt=e(T);$t(xt,17,()=>t(Yt),Ht,(d,l)=>{var L=Je(),Q=s(L,!0);a(L);var U={};M(()=>{b(Q,t(l).name),U!==(U=t(l).id)&&(L.value=(L.__value=t(l).id)??"")}),f(d,L)}),a(E),a(p),a(A);var w=e(A,2),j=s(w),N=e(s(j),2);C(N),a(j);var z=e(j,2),O=e(s(z),2);C(O),a(z);var dt=e(z,2),q=e(s(dt),2);C(q),a(dt),a(w);var B=e(w,2),P=e(s(B),2),G=e(s(P));$t(G,21,()=>t(y),Ht,(d,l,L)=>{var Q=We(),U=s(Q),Wt=s(U);C(Wt),a(U);var Rt=e(U),Xt=s(Rt);C(Xt),a(Rt);var Nt=e(Rt),Zt=s(Nt);C(Zt),a(Nt);var Ot=e(Nt),qt=s(Ot),Ft=s(qt);Ft.value=Ft.__value="22";var kt=e(Ft);kt.value=kt.__value="9";var te=e(kt);te.value=te.__value="0",a(qt),a(Ot);var Ut=e(Ot),ee=s(Ut);C(ee),a(Ut);var Vt=e(Ut),Te=s(Vt,!0);a(Vt);var ae=e(Vt),we=s(ae);{var Pe=v=>{var se=Me();se.__click=()=>ce(L),f(v,se)};V(we,v=>{t(y).length>1&&v(Pe)})}a(ae),a(Q),M(v=>b(Te,v),[()=>bt(jt(t(l)))]),S(Wt,()=>t(l).description,v=>t(l).description=v),S(Xt,()=>t(l).quantity,v=>t(l).quantity=v),S(Zt,()=>t(l).unit_price,v=>t(l).unit_price=v),W(qt,()=>t(l).vat_rate,v=>t(l).vat_rate=v),S(ee,()=>t(l).discount_percent,v=>t(l).discount_percent=v),f(d,Q)}),a(G);var F=e(G),k=s(F),lt=e(s(k)),K=s(lt),Lt=s(K,!0);a(K),a(lt),oe(),a(k),a(F),a(P);var Ct=e(P,2);Ct.__click=ve,a(B);var D=e(B,2),x=e(s(D),2);qe(x),a(D);var vt=e(D,2),ct=s(vt);ct.__click=()=>n(H,!1),oe(2),a(vt),a(u),a(i),a(o),M(d=>b(Lt,d),[()=>bt(ue())]),Ve("submit",u,_e),W(m,()=>t(tt),d=>n(tt,d)),W(E,()=>t(et),d=>n(et,d)),S(N,()=>t(at),d=>n(at,d)),S(O,()=>t(st),d=>n(st,d)),S(q,()=>t(rt),d=>n(rt,d)),S(x,()=>t(ot),d=>n(ot,d)),f(r,o)};V(Ae,r=>{t(H)&&r(Ee)})}W(Y,()=>t(pt),r=>n(pt,r)),W(nt,()=>t(ft),r=>n(ft,r)),f(ne,Gt),Re(),le()}Ue(["click","change"]);export{va as component};
