import{f as p,a as u,c as Ot,t as St}from"../chunks/CPI-Sj6W.js";import{o as ne}from"../chunks/BdGAytfj.js";import{p as ie,z as x,A as _t,B as Lt,a as le,D as de,C as o,E as r,g as t,I as ce,s as i,$ as ve,F as e,G as w,H as ue}from"../chunks/DZJbeXPm.js";import{s as b}from"../chunks/DRMUDMiI.js";import{i as y}from"../chunks/LXw8YH9d.js";import{e as pt,i as bt,s as Vt}from"../chunks/DksMkqyi.js";import{h as _e,r as M,b as X}from"../chunks/D8iSYxBw.js";import{d as pe,e as be}from"../chunks/D1vpSegM.js";import{p as fe,b as ye}from"../chunks/BK0TuHnG.js";import{a as me,s as ge}from"../chunks/CWTv1oOY.js";import{a as ft,D as Z}from"../chunks/DOQewpRz.js";var ke=p('<button class="btn btn-primary">+ New Entry</button>'),he=p('<div class="alert alert-error"> </div>'),xe=p("<p>Loading...</p>"),De=p('<div class="card empty-state svelte-1gt2yrk"><p class="svelte-1gt2yrk">Please select a tenant from the <a href="/dashboard">dashboard</a>.</p></div>'),Ee=p('<div class="card empty-state svelte-1gt2yrk"><h2 class="svelte-1gt2yrk">No Journal Entries</h2> <p class="svelte-1gt2yrk">Create your first journal entry to record a transaction.</p> <button class="btn btn-primary">Create Journal Entry</button></div>'),we=p('<button class="btn btn-sm btn-primary">Post</button>'),Ie=p('<button class="btn btn-sm btn-danger">Void</button>'),Ce=p('<p class="entry-reference svelte-1gt2yrk"> </p>'),$e=p('<tr><td class="svelte-1gt2yrk"> </td><td class="svelte-1gt2yrk"> </td><td class="amount svelte-1gt2yrk"> </td><td class="amount svelte-1gt2yrk"> </td></tr>'),Ae=p('<p class="void-reason svelte-1gt2yrk"> </p>'),Fe=p('<div class="card entry-card svelte-1gt2yrk"><div class="entry-header svelte-1gt2yrk"><div class="entry-info svelte-1gt2yrk"><span class="entry-number svelte-1gt2yrk"> </span> <span class="entry-date svelte-1gt2yrk"> </span> <span> </span></div> <div class="entry-actions"><!> <!></div></div> <p class="entry-description svelte-1gt2yrk"> </p> <!> <table class="lines-table svelte-1gt2yrk"><thead><tr><th class="svelte-1gt2yrk">Account</th><th class="svelte-1gt2yrk">Description</th><th class="amount svelte-1gt2yrk">Debit</th><th class="amount svelte-1gt2yrk">Credit</th></tr></thead><tbody></tbody></table> <!></div>'),Je=p('<div class="entries-list svelte-1gt2yrk"></div>'),Le=p('<div class="alert alert-error"> </div>'),qe=p("<option> </option>"),Pe=p('<button type="button" class="btn btn-sm btn-danger">X</button>'),Te=p('<tr><td class="svelte-1gt2yrk"><select class="input svelte-1gt2yrk" required><option>Select account</option><!></select></td><td class="svelte-1gt2yrk"><input class="input svelte-1gt2yrk" type="text"/></td><td class="amount svelte-1gt2yrk"><input class="input svelte-1gt2yrk" type="number" step="0.01" min="0" placeholder="0.00"/></td><td class="amount svelte-1gt2yrk"><input class="input svelte-1gt2yrk" type="number" step="0.01" min="0" placeholder="0.00"/></td><td class="svelte-1gt2yrk"><!></td></tr>'),Ne=p('<div class="modal-backdrop svelte-1gt2yrk" role="presentation"><div class="modal card modal-lg svelte-1gt2yrk" role="dialog" aria-modal="true" aria-labelledby="create-journal-title" tabindex="-1"><h2 id="create-journal-title" class="svelte-1gt2yrk">Create Journal Entry</h2> <!> <form><div class="form-row svelte-1gt2yrk"><div class="form-group"><label class="label" for="entryDate">Date</label> <input class="input" type="date" id="entryDate" required/></div> <div class="form-group"><label class="label" for="reference">Reference</label> <input class="input" type="text" id="reference" placeholder="INV-001, etc."/></div></div> <div class="form-group"><label class="label" for="description">Description</label> <input class="input" type="text" id="description" required placeholder="Description of this transaction"/></div> <h3 class="svelte-1gt2yrk">Lines</h3> <table class="lines-table edit-mode svelte-1gt2yrk"><thead><tr><th class="svelte-1gt2yrk">Account</th><th class="svelte-1gt2yrk">Description</th><th class="amount svelte-1gt2yrk">Debit</th><th class="amount svelte-1gt2yrk">Credit</th><th class="svelte-1gt2yrk"></th></tr></thead><tbody></tbody><tfoot class="svelte-1gt2yrk"><tr class="totals svelte-1gt2yrk"><td colspan="2" class="svelte-1gt2yrk"><button type="button" class="btn btn-sm btn-secondary">+ Add Line</button></td><td class="amount svelte-1gt2yrk"> </td><td class="amount svelte-1gt2yrk"> </td><td class="svelte-1gt2yrk"></td></tr><tr class="balance-check svelte-1gt2yrk"><td colspan="5"><!></td></tr></tfoot></table> <div class="modal-actions svelte-1gt2yrk"><button type="button" class="btn btn-secondary">Cancel</button> <button type="submit" class="btn btn-primary">Create Entry</button></div></form></div></div>'),Oe=p('<div class="container"><div class="header svelte-1gt2yrk"><h1 class="svelte-1gt2yrk">Journal Entries</h1> <!></div> <!> <!></div> <!>',1);function Ke(jt,Bt){ie(Bt,!0);const Rt=()=>ge(fe,"$page",zt),[zt,Gt]=me();let A=ce(()=>Rt().url.searchParams.get("tenant")||""),I=x(_t([])),yt=x(_t([])),mt=x(!0),O=x(""),F=x(!1),S=x(""),gt=x(_t(new Date().toISOString().split("T")[0])),nt=x(""),it=x(""),m=x(_t([{accountId:"",description:"",debit:"",credit:""},{accountId:"",description:"",debit:"",credit:""}]));ne(async()=>{if(!t(A)){i(O,"No tenant selected. Please select a tenant from the dashboard."),i(mt,!1);return}try{i(yt,await ft.listAccounts(t(A),!0),!0)}catch(a){i(O,a instanceof Error?a.message:"Failed to load accounts",!0)}finally{i(mt,!1)}});function Ht(){i(m,[...t(m),{accountId:"",description:"",debit:"",credit:""}],!0)}function Mt(a){t(m).length>2&&i(m,t(m).filter((s,n)=>n!==a),!0)}function kt(){return t(m).reduce((a,s)=>{const n=s.debit?new Z(s.debit):new Z(0);return a.plus(n)},new Z(0))}function ht(){return t(m).reduce((a,s)=>{const n=s.credit?new Z(s.credit):new Z(0);return a.plus(n)},new Z(0))}function K(){return kt().equals(ht())}async function Xt(a){if(a.preventDefault(),i(S,""),!K()){i(S,"Debits must equal credits");return}const s=t(m).filter(n=>n.accountId&&(n.debit||n.credit));if(s.length<2){i(S,"At least two lines with amounts are required");return}try{const n={entry_date:t(gt),description:t(nt),reference:t(it)||void 0,lines:s.map(C=>({account_id:C.accountId,description:C.description||void 0,debit_amount:C.debit||"0",credit_amount:C.credit||"0"}))},V=await ft.createJournalEntry(t(A),n);i(I,[V,...t(I)],!0),i(F,!1),i(nt,""),i(it,""),i(m,[{accountId:"",description:"",debit:"",credit:""},{accountId:"",description:"",debit:"",credit:""}],!0)}catch(n){i(S,n instanceof Error?n.message:"Failed to create entry",!0)}}async function Zt(a){try{await ft.postJournalEntry(t(A),a.id),a.status="POSTED",i(I,[...t(I)],!0)}catch(s){i(O,s instanceof Error?s.message:"Failed to post entry",!0)}}async function Kt(a){const s=prompt("Enter reason for voiding:");if(s)try{await ft.voidJournalEntry(t(A),a.id,s),a.status="VOIDED",a.void_reason=s,i(I,[...t(I)],!0)}catch(n){i(O,n instanceof Error?n.message:"Failed to void entry",!0)}}function qt(a){return!a||a.isZero()?"-":a.toFixed(2)}function Qt(a){const s=t(yt).find(n=>n.id===a);return s?`${s.code} - ${s.name}`:a}var Pt=Oe();_e("1gt2yrk",a=>{de(()=>{ve.title="Journal Entries - Open Accounting"})});var xt=Lt(Pt),Dt=r(xt),Ut=o(r(Dt),2);{var Wt=a=>{var s=ke();s.__click=()=>i(F,!0),u(a,s)};y(Ut,a=>{t(A)&&a(Wt)})}e(Dt);var Tt=o(Dt,2);{var Yt=a=>{var s=he(),n=r(s,!0);e(s),w(()=>b(n,t(O))),u(a,s)};y(Tt,a=>{t(O)&&a(Yt)})}var te=o(Tt,2);{var ee=a=>{var s=xe();u(a,s)},re=a=>{var s=Ot(),n=Lt(s);{var V=h=>{var $=De();u(h,$)},C=h=>{var $=Ot(),Q=Lt($);{var lt=D=>{var g=Ee(),j=o(r(g),4);j.__click=()=>i(F,!0),e(g),u(D,g)},dt=D=>{var g=Je();pt(g,21,()=>t(I),bt,(j,_)=>{var J=Fe(),B=r(J),L=r(B),q=r(L),Et=r(q);e(q);var P=o(q,2),wt=r(P,!0);e(P);var R=o(P,2),It=r(R,!0);e(R),e(L);var U=o(L,2),z=r(U);{var ct=d=>{var v=we();v.__click=()=>Zt(t(_)),u(d,v)};y(z,d=>{t(_).status==="DRAFT"&&d(ct)})}var Ct=o(z,2);{var $t=d=>{var v=Ie();v.__click=()=>Kt(t(_)),u(d,v)};y(Ct,d=>{t(_).status==="POSTED"&&d($t)})}e(U),e(B);var W=o(B,2),vt=r(W,!0);e(W);var Y=o(W,2);{var At=d=>{var v=Ce(),k=r(v);e(v),w(()=>b(k,`Ref: ${t(_).reference??""}`)),u(d,v)};y(Y,d=>{t(_).reference&&d(At)})}var l=o(Y,2),c=o(r(l));pt(c,21,()=>t(_).lines,bt,(d,v)=>{var k=$e(),tt=r(k),et=r(tt,!0);e(tt);var G=o(tt),rt=r(G,!0);e(G);var H=o(G),at=r(H,!0);e(H);var st=o(H),ut=r(st,!0);e(st),e(k),w((Ft,Jt,f)=>{b(et,Ft),b(rt,t(v).description||"-"),b(at,Jt),b(ut,f)},[()=>Qt(t(v).account_id),()=>qt(t(v).debit_amount),()=>qt(t(v).credit_amount)]),u(d,k)}),e(c),e(l);var E=o(l,2);{var T=d=>{var v=Ae(),k=r(v);e(v),w(()=>b(k,`Void reason: ${t(_).void_reason??""}`)),u(d,v)};y(E,d=>{t(_).void_reason&&d(T)})}e(J),w(d=>{b(Et,`#${t(_).entry_number??""}`),b(wt,t(_).entry_date),Vt(R,1,`badge status-${d??""}`,"svelte-1gt2yrk"),b(It,t(_).status),b(vt,t(_).description)},[()=>t(_).status.toLowerCase()]),u(j,J)}),e(g),u(D,g)};y(Q,D=>{t(I).length===0&&!t(F)?D(lt):D(dt,!1)},!0)}u(h,$)};y(n,h=>{t(A)?h(C,!1):h(V)},!0)}u(a,s)};y(te,a=>{t(mt)?a(ee):a(re,!1)})}e(xt);var ae=o(xt,2);{var se=a=>{var s=Ne();s.__click=()=>i(F,!1);var n=r(s);n.__click=l=>l.stopPropagation();var V=o(r(n),2);{var C=l=>{var c=Le(),E=r(c,!0);e(c),w(()=>b(E,t(S))),u(l,c)};y(V,l=>{t(S)&&l(C)})}var h=o(V,2),$=r(h),Q=r($),lt=o(r(Q),2);M(lt),e(Q);var dt=o(Q,2),D=o(r(dt),2);M(D),e(dt),e($);var g=o($,2),j=o(r(g),2);M(j),e(g);var _=o(g,4),J=o(r(_));pt(J,21,()=>t(m),bt,(l,c,E)=>{var T=Te(),d=r(T),v=r(d),k=r(v);k.value=k.__value="";var tt=o(k);pt(tt,17,()=>t(yt),bt,(f,N)=>{var ot=qe(),oe=r(ot);e(ot);var Nt={};w(()=>{b(oe,`${t(N).code??""} - ${t(N).name??""}`),Nt!==(Nt=t(N).id)&&(ot.value=(ot.__value=t(N).id)??"")}),u(f,ot)}),e(v),e(d);var et=o(d),G=r(et);M(G),e(et);var rt=o(et),H=r(rt);M(H),e(rt);var at=o(rt),st=r(at);M(st),e(at);var ut=o(at),Ft=r(ut);{var Jt=f=>{var N=Pe();N.__click=()=>Mt(E),u(f,N)};y(Ft,f=>{t(m).length>2&&f(Jt)})}e(ut),e(T),ye(v,()=>t(c).accountId,f=>t(c).accountId=f),X(G,()=>t(c).description,f=>t(c).description=f),X(H,()=>t(c).debit,f=>t(c).debit=f),X(st,()=>t(c).credit,f=>t(c).credit=f),u(l,T)}),e(J);var B=o(J),L=r(B),q=r(L),Et=r(q);Et.__click=Ht,e(q);var P=o(q),wt=r(P,!0);e(P);var R=o(P),It=r(R,!0);e(R),ue(),e(L);var U=o(L),z=r(U);let ct;var Ct=r(z);{var $t=l=>{var c=St("Balanced");u(l,c)},W=l=>{var c=St();w(E=>b(c,`Difference: ${E??""}`),[()=>kt().minus(ht()).toFixed(2)]),u(l,c)};y(Ct,l=>{K()?l($t):l(W,!1)})}e(z),e(U),e(B),e(_);var vt=o(_,2),Y=r(vt);Y.__click=()=>i(F,!1);var At=o(Y,2);e(vt),e(h),e(n),e(s),w((l,c,E,T)=>{b(wt,l),b(It,c),ct=Vt(z,1,"svelte-1gt2yrk",null,ct,E),At.disabled=T},[()=>kt().toFixed(2),()=>ht().toFixed(2),()=>({balanced:K(),unbalanced:!K()}),()=>!K()]),be("submit",h,Xt),X(lt,()=>t(gt),l=>i(gt,l)),X(D,()=>t(it),l=>i(it,l)),X(j,()=>t(nt),l=>i(nt,l)),u(a,s)};y(ae,a=>{t(F)&&a(se)})}u(jt,Pt),le(),Gt()}pe(["click"]);export{Ke as component};
