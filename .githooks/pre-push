#!/bin/bash
# Pre-push hook: catch lint issues before they hit CI
# Install: git config core.hooksPath .githooks
set -e
cd "$(git rev-parse --show-toplevel)"

echo "üîç Pre-push lint check..."

# Quick gofmt check (fast)
UNFORMATTED=$(gofmt -l . 2>/dev/null | grep -v vendor || true)
if [[ -n "$UNFORMATTED" ]]; then
  echo "‚ùå Unformatted Go files ‚Äî run 'gofmt -w .' first:"
  echo "$UNFORMATTED"
  exit 1
fi

# Full lint (slower but catches everything CI catches)
if ! golangci-lint run --timeout=5m 2>/dev/null; then
  echo ""
  echo "‚ùå Lint errors detected. Fix before pushing."
  echo "   Run: golangci-lint run --timeout=5m"
  echo "   Auto-fix formatting: ./scripts/fix-lint.sh"
  exit 1
fi

echo "‚úÖ Lint clean, pushing..."
