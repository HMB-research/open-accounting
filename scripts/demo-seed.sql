-- Open Accounting Demo Seed Data
-- This creates sample data for demonstration purposes
-- Run with: psql $DATABASE_URL -f scripts/demo-seed.sql

-- =============================================================================
-- DEMO USER (password: demo123)
-- =============================================================================

INSERT INTO users (id, email, password_hash, name, is_active)
VALUES (
    'a0000000-0000-0000-0000-000000000001'::uuid,
    'demo@example.com',
    '$2a$10$m/V.x2rKPDFQj6xo9voXAeCXJBua.EzF.A3v1bnreBdgbAaKBcsTu', -- demo123
    'Demo User',
    true
) ON CONFLICT (email) DO NOTHING;

-- =============================================================================
-- DEMO TENANT
-- =============================================================================

INSERT INTO tenants (id, name, slug, schema_name, settings, is_active)
VALUES (
    'b0000000-0000-0000-0000-000000000001'::uuid,
    'Acme Corporation',
    'acme',
    'tenant_acme',
    '{
        "reg_code": "12345678",
        "vat_number": "EE123456789",
        "address": "Viru väljak 2, 10111 Tallinn",
        "email": "info@acme.example.com",
        "phone": "+372 5123 4567",
        "bank_details": "Swedbank EE123456789012345678",
        "invoice_prefix": "INV-",
        "invoice_footer": "Thank you for your business!",
        "default_payment_terms": 14,
        "pdf_primary_color": "#4f46e5"
    }'::jsonb,
    true
) ON CONFLICT (slug) DO NOTHING;

-- Link demo user to tenant
INSERT INTO tenant_users (tenant_id, user_id, role, is_default)
VALUES (
    'b0000000-0000-0000-0000-000000000001'::uuid,
    'a0000000-0000-0000-0000-000000000001'::uuid,
    'admin',
    true
) ON CONFLICT (tenant_id, user_id) DO NOTHING;

-- =============================================================================
-- CREATE TENANT SCHEMA
-- =============================================================================

SELECT create_tenant_schema('tenant_acme');

-- =============================================================================
-- CHART OF ACCOUNTS (Estonian standard chart)
-- =============================================================================

INSERT INTO tenant_acme.accounts (id, tenant_id, code, name, account_type, is_system) VALUES
-- Assets (1xxx)
('c0000000-0000-0000-0001-000000000001'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '1000', 'Cash', 'ASSET', true),
('c0000000-0000-0000-0001-000000000002'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '1100', 'Bank Account - EUR', 'ASSET', true),
('c0000000-0000-0000-0001-000000000003'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '1200', 'Accounts Receivable', 'ASSET', true),
('c0000000-0000-0000-0001-000000000004'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '1300', 'Inventory', 'ASSET', false),
('c0000000-0000-0000-0001-000000000005'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '1500', 'Prepaid Expenses', 'ASSET', false),
('c0000000-0000-0000-0001-000000000006'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '1600', 'Fixed Assets', 'ASSET', false),
('c0000000-0000-0000-0001-000000000007'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '1700', 'Accumulated Depreciation', 'ASSET', false),

-- Liabilities (2xxx)
('c0000000-0000-0000-0002-000000000001'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '2000', 'Accounts Payable', 'LIABILITY', true),
('c0000000-0000-0000-0002-000000000002'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '2100', 'VAT Payable', 'LIABILITY', true),
('c0000000-0000-0000-0002-000000000003'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '2200', 'Income Tax Payable', 'LIABILITY', true),
('c0000000-0000-0000-0002-000000000004'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '2300', 'Social Tax Payable', 'LIABILITY', true),
('c0000000-0000-0000-0002-000000000005'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '2400', 'Salaries Payable', 'LIABILITY', true),
('c0000000-0000-0000-0002-000000000006'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '2500', 'Pension Fund Payable', 'LIABILITY', true),
('c0000000-0000-0000-0002-000000000007'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '2600', 'Unemployment Insurance Payable', 'LIABILITY', true),
('c0000000-0000-0000-0002-000000000008'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '2900', 'Other Liabilities', 'LIABILITY', false),

-- Equity (3xxx)
('c0000000-0000-0000-0003-000000000001'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '3000', 'Share Capital', 'EQUITY', true),
('c0000000-0000-0000-0003-000000000002'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '3100', 'Retained Earnings', 'EQUITY', true),
('c0000000-0000-0000-0003-000000000003'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '3200', 'Current Year Earnings', 'EQUITY', true),

-- Revenue (4xxx)
('c0000000-0000-0000-0004-000000000001'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '4000', 'Sales Revenue', 'REVENUE', true),
('c0000000-0000-0000-0004-000000000002'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '4100', 'Service Revenue', 'REVENUE', true),
('c0000000-0000-0000-0004-000000000003'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '4900', 'Other Income', 'REVENUE', false),

-- Expenses (5xxx-7xxx)
('c0000000-0000-0000-0005-000000000001'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '5000', 'Cost of Goods Sold', 'EXPENSE', true),
('c0000000-0000-0000-0005-000000000002'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '6000', 'Salaries Expense', 'EXPENSE', true),
('c0000000-0000-0000-0005-000000000003'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '6100', 'Social Tax Expense', 'EXPENSE', true),
('c0000000-0000-0000-0005-000000000004'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '6200', 'Rent Expense', 'EXPENSE', false),
('c0000000-0000-0000-0005-000000000005'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '6300', 'Utilities Expense', 'EXPENSE', false),
('c0000000-0000-0000-0005-000000000006'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '6400', 'Office Supplies', 'EXPENSE', false),
('c0000000-0000-0000-0005-000000000007'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '6500', 'Marketing Expense', 'EXPENSE', false),
('c0000000-0000-0000-0005-000000000008'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '6600', 'Travel Expense', 'EXPENSE', false),
('c0000000-0000-0000-0005-000000000009'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '6700', 'Professional Services', 'EXPENSE', false),
('c0000000-0000-0000-0005-000000000010'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '6800', 'Depreciation Expense', 'EXPENSE', false),
('c0000000-0000-0000-0005-000000000011'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '6900', 'Other Expenses', 'EXPENSE', false),
('c0000000-0000-0000-0005-000000000012'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, '7000', 'Bank Fees', 'EXPENSE', false)
ON CONFLICT DO NOTHING;

-- =============================================================================
-- CONTACTS (Customers & Suppliers)
-- =============================================================================

INSERT INTO tenant_acme.contacts (id, tenant_id, code, name, contact_type, reg_code, vat_number, email, phone, address_line1, city, postal_code, country_code, payment_terms_days) VALUES
-- Customers
('d0000000-0000-0000-0001-000000000001'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'C001', 'TechStart OÜ', 'CUSTOMER', '14567890', 'EE145678901', 'info@techstart.ee', '+372 5234 5678', 'Pärnu mnt 15', 'Tallinn', '10141', 'EE', 14),
('d0000000-0000-0000-0001-000000000002'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'C002', 'Nordic Solutions AS', 'CUSTOMER', '98765432', 'EE987654321', 'orders@nordic.ee', '+372 5345 6789', 'Tartu mnt 83', 'Tallinn', '10115', 'EE', 30),
('d0000000-0000-0000-0001-000000000003'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'C003', 'Baltic Commerce', 'CUSTOMER', '11223344', 'EE112233445', 'accounting@baltic.ee', '+372 5456 7890', 'Narva mnt 7', 'Tallinn', '10117', 'EE', 14),
('d0000000-0000-0000-0001-000000000004'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'C004', 'GreenTech Industries', 'CUSTOMER', '55667788', 'EE556677889', 'finance@greentech.ee', '+372 5567 8901', 'Lõõtsa 5', 'Tallinn', '11415', 'EE', 21),

-- Suppliers
('d0000000-0000-0000-0002-000000000001'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'S001', 'Office Supplies Ltd', 'SUPPLIER', '33445566', NULL, 'orders@officesupplies.ee', '+372 5678 9012', 'Peterburi tee 71', 'Tallinn', '11415', 'EE', 30),
('d0000000-0000-0000-0002-000000000002'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'S002', 'CloudHost Services', 'SUPPLIER', '44556677', 'EE445566778', 'billing@cloudhost.ee', '+372 5789 0123', 'Ülemiste tee 5', 'Tallinn', '11415', 'EE', 14),
('d0000000-0000-0000-0002-000000000003'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'S003', 'Marketing Agency OÜ', 'SUPPLIER', '77889900', 'EE778899001', 'invoices@marketing.ee', '+372 5890 1234', 'Telliskivi 60a', 'Tallinn', '10412', 'EE', 14)
ON CONFLICT DO NOTHING;

-- =============================================================================
-- INVOICES (Mix of statuses)
-- =============================================================================

INSERT INTO tenant_acme.invoices (id, tenant_id, invoice_number, invoice_type, contact_id, issue_date, due_date, subtotal, vat_amount, total, base_subtotal, base_vat_amount, base_total, amount_paid, status, created_by) VALUES
-- Paid invoices
('e0000000-0000-0000-0001-000000000001'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'INV-2024-001', 'SALES', 'd0000000-0000-0000-0001-000000000001'::uuid, '2024-11-01', '2024-11-15', 2500.00, 550.00, 3050.00, 2500.00, 550.00, 3050.00, 3050.00, 'PAID', 'a0000000-0000-0000-0000-000000000001'::uuid),
('e0000000-0000-0000-0001-000000000002'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'INV-2024-002', 'SALES', 'd0000000-0000-0000-0001-000000000002'::uuid, '2024-11-05', '2024-12-05', 8750.00, 1925.00, 10675.00, 8750.00, 1925.00, 10675.00, 10675.00, 'PAID', 'a0000000-0000-0000-0000-000000000001'::uuid),
('e0000000-0000-0000-0001-000000000003'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'INV-2024-003', 'SALES', 'd0000000-0000-0000-0001-000000000003'::uuid, '2024-11-10', '2024-11-24', 1200.00, 264.00, 1464.00, 1200.00, 264.00, 1464.00, 1464.00, 'PAID', 'a0000000-0000-0000-0000-000000000001'::uuid),

-- Sent/Outstanding invoices
('e0000000-0000-0000-0001-000000000004'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'INV-2024-004', 'SALES', 'd0000000-0000-0000-0001-000000000001'::uuid, '2024-12-01', '2024-12-15', 3200.00, 704.00, 3904.00, 3200.00, 704.00, 3904.00, 0.00, 'SENT', 'a0000000-0000-0000-0000-000000000001'::uuid),
('e0000000-0000-0000-0001-000000000005'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'INV-2024-005', 'SALES', 'd0000000-0000-0000-0001-000000000004'::uuid, '2024-12-10', '2024-12-31', 5500.00, 1210.00, 6710.00, 5500.00, 1210.00, 6710.00, 0.00, 'SENT', 'a0000000-0000-0000-0000-000000000001'::uuid),

-- Partially paid
('e0000000-0000-0000-0001-000000000006'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'INV-2024-006', 'SALES', 'd0000000-0000-0000-0001-000000000002'::uuid, '2024-12-05', '2025-01-04', 12000.00, 2640.00, 14640.00, 12000.00, 2640.00, 14640.00, 7000.00, 'PARTIALLY_PAID', 'a0000000-0000-0000-0000-000000000001'::uuid),

-- Draft invoice
('e0000000-0000-0000-0001-000000000007'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'INV-2024-007', 'SALES', 'd0000000-0000-0000-0001-000000000003'::uuid, '2024-12-20', '2025-01-03', 4800.00, 1056.00, 5856.00, 4800.00, 1056.00, 5856.00, 0.00, 'DRAFT', 'a0000000-0000-0000-0000-000000000001'::uuid),

-- Current month invoices
('e0000000-0000-0000-0001-000000000008'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'INV-2025-001', 'SALES', 'd0000000-0000-0000-0001-000000000001'::uuid, CURRENT_DATE - INTERVAL '5 days', CURRENT_DATE + INTERVAL '9 days', 1850.00, 407.00, 2257.00, 1850.00, 407.00, 2257.00, 0.00, 'SENT', 'a0000000-0000-0000-0000-000000000001'::uuid),
('e0000000-0000-0000-0001-000000000009'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'INV-2025-002', 'SALES', 'd0000000-0000-0000-0001-000000000004'::uuid, CURRENT_DATE - INTERVAL '2 days', CURRENT_DATE + INTERVAL '12 days', 6200.00, 1364.00, 7564.00, 6200.00, 1364.00, 7564.00, 0.00, 'SENT', 'a0000000-0000-0000-0000-000000000001'::uuid)
ON CONFLICT DO NOTHING;

-- =============================================================================
-- INVOICE LINES
-- =============================================================================

INSERT INTO tenant_acme.invoice_lines (tenant_id, invoice_id, line_number, description, quantity, unit, unit_price, vat_rate, line_subtotal, line_vat, line_total, account_id) VALUES
-- INV-2024-001
('b0000000-0000-0000-0000-000000000001'::uuid, 'e0000000-0000-0000-0001-000000000001'::uuid, 1, 'Software Development Services - November', 50, 'hours', 50.00, 22.00, 2500.00, 550.00, 3050.00, 'c0000000-0000-0000-0004-000000000002'::uuid),

-- INV-2024-002
('b0000000-0000-0000-0000-000000000001'::uuid, 'e0000000-0000-0000-0001-000000000002'::uuid, 1, 'ERP Implementation - Phase 1', 1, 'project', 5000.00, 22.00, 5000.00, 1100.00, 6100.00, 'c0000000-0000-0000-0004-000000000002'::uuid),
('b0000000-0000-0000-0000-000000000001'::uuid, 'e0000000-0000-0000-0001-000000000002'::uuid, 2, 'Training & Documentation', 15, 'hours', 250.00, 22.00, 3750.00, 825.00, 4575.00, 'c0000000-0000-0000-0004-000000000002'::uuid),

-- INV-2024-003
('b0000000-0000-0000-0000-000000000001'::uuid, 'e0000000-0000-0000-0001-000000000003'::uuid, 1, 'Monthly Support Package', 1, 'month', 1200.00, 22.00, 1200.00, 264.00, 1464.00, 'c0000000-0000-0000-0004-000000000002'::uuid),

-- INV-2024-004
('b0000000-0000-0000-0000-000000000001'::uuid, 'e0000000-0000-0000-0001-000000000004'::uuid, 1, 'Custom Integration Development', 40, 'hours', 80.00, 22.00, 3200.00, 704.00, 3904.00, 'c0000000-0000-0000-0004-000000000002'::uuid),

-- INV-2024-005
('b0000000-0000-0000-0000-000000000001'::uuid, 'e0000000-0000-0000-0001-000000000005'::uuid, 1, 'Cloud Migration Services', 1, 'project', 4000.00, 22.00, 4000.00, 880.00, 4880.00, 'c0000000-0000-0000-0004-000000000002'::uuid),
('b0000000-0000-0000-0000-000000000001'::uuid, 'e0000000-0000-0000-0001-000000000005'::uuid, 2, 'Infrastructure Setup', 1, 'fixed', 1500.00, 22.00, 1500.00, 330.00, 1830.00, 'c0000000-0000-0000-0004-000000000002'::uuid),

-- INV-2024-006
('b0000000-0000-0000-0000-000000000001'::uuid, 'e0000000-0000-0000-0001-000000000006'::uuid, 1, 'Enterprise Software License', 12, 'months', 1000.00, 22.00, 12000.00, 2640.00, 14640.00, 'c0000000-0000-0000-0004-000000000001'::uuid),

-- INV-2024-007
('b0000000-0000-0000-0000-000000000001'::uuid, 'e0000000-0000-0000-0001-000000000007'::uuid, 1, 'API Development', 30, 'hours', 120.00, 22.00, 3600.00, 792.00, 4392.00, 'c0000000-0000-0000-0004-000000000002'::uuid),
('b0000000-0000-0000-0000-000000000001'::uuid, 'e0000000-0000-0000-0001-000000000007'::uuid, 2, 'Testing & QA', 10, 'hours', 120.00, 22.00, 1200.00, 264.00, 1464.00, 'c0000000-0000-0000-0004-000000000002'::uuid),

-- INV-2025-001
('b0000000-0000-0000-0000-000000000001'::uuid, 'e0000000-0000-0000-0001-000000000008'::uuid, 1, 'Consulting Services', 15, 'hours', 100.00, 22.00, 1500.00, 330.00, 1830.00, 'c0000000-0000-0000-0004-000000000002'::uuid),
('b0000000-0000-0000-0000-000000000001'::uuid, 'e0000000-0000-0000-0001-000000000008'::uuid, 2, 'Support Ticket Resolution', 5, 'tickets', 70.00, 22.00, 350.00, 77.00, 427.00, 'c0000000-0000-0000-0004-000000000002'::uuid),

-- INV-2025-002
('b0000000-0000-0000-0000-000000000001'::uuid, 'e0000000-0000-0000-0001-000000000009'::uuid, 1, 'Annual Maintenance Contract', 1, 'year', 6200.00, 22.00, 6200.00, 1364.00, 7564.00, 'c0000000-0000-0000-0004-000000000001'::uuid)
ON CONFLICT DO NOTHING;

-- =============================================================================
-- PAYMENTS
-- =============================================================================

INSERT INTO tenant_acme.payments (id, tenant_id, payment_number, payment_type, contact_id, payment_date, amount, base_amount, payment_method, reference, created_by) VALUES
('f0000000-0000-0000-0001-000000000001'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'PAY-2024-001', 'RECEIVED', 'd0000000-0000-0000-0001-000000000001'::uuid, '2024-11-12', 3050.00, 3050.00, 'Bank Transfer', 'INV-2024-001', 'a0000000-0000-0000-0000-000000000001'::uuid),
('f0000000-0000-0000-0001-000000000002'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'PAY-2024-002', 'RECEIVED', 'd0000000-0000-0000-0001-000000000002'::uuid, '2024-11-28', 10675.00, 10675.00, 'Bank Transfer', 'INV-2024-002', 'a0000000-0000-0000-0000-000000000001'::uuid),
('f0000000-0000-0000-0001-000000000003'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'PAY-2024-003', 'RECEIVED', 'd0000000-0000-0000-0001-000000000003'::uuid, '2024-11-22', 1464.00, 1464.00, 'Bank Transfer', 'INV-2024-003', 'a0000000-0000-0000-0000-000000000001'::uuid),
('f0000000-0000-0000-0001-000000000004'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'PAY-2024-004', 'RECEIVED', 'd0000000-0000-0000-0001-000000000002'::uuid, '2024-12-15', 7000.00, 7000.00, 'Bank Transfer', 'Partial payment INV-2024-006', 'a0000000-0000-0000-0000-000000000001'::uuid)
ON CONFLICT DO NOTHING;

-- =============================================================================
-- FISCAL YEAR
-- =============================================================================

INSERT INTO tenant_acme.fiscal_years (id, tenant_id, name, start_date, end_date, is_closed) VALUES
('90000000-0000-0000-0001-000000000001'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'FY 2024', '2024-01-01', '2024-12-31', false),
('90000000-0000-0000-0001-000000000002'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'FY 2025', '2025-01-01', '2025-12-31', false)
ON CONFLICT DO NOTHING;

-- =============================================================================
-- BANK ACCOUNTS
-- =============================================================================

INSERT INTO tenant_acme.bank_accounts (id, tenant_id, name, account_number, bank_name, currency, opening_balance, current_balance, is_active) VALUES
('80000000-0000-0000-0001-000000000001'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'Main EUR Account', 'EE123456789012345678', 'Swedbank', 'EUR', 50000.00, 72189.00, true),
('80000000-0000-0000-0001-000000000002'::uuid, 'b0000000-0000-0000-0000-000000000001'::uuid, 'Savings Account', 'EE987654321098765432', 'SEB', 'EUR', 10000.00, 10000.00, true)
ON CONFLICT DO NOTHING;

-- =============================================================================
-- SUCCESS MESSAGE
-- =============================================================================

DO $$
BEGIN
    RAISE NOTICE '========================================';
    RAISE NOTICE 'Demo seed completed successfully!';
    RAISE NOTICE '';
    RAISE NOTICE 'Demo Login Credentials:';
    RAISE NOTICE '  Email: demo@openaccounting.io';
    RAISE NOTICE '  Password: demo123';
    RAISE NOTICE '';
    RAISE NOTICE 'Demo Organization: Acme Corporation';
    RAISE NOTICE '========================================';
END $$;
